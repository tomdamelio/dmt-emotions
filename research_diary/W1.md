Sabado 30 de Agosto
--------------------
[x] Armar en `docs/` el readme del proyecto con el orden en que deben correrse.
[x] Guardar los archivos de datos viejos en `../data/old/`
[x] Guardar la data originar en `../data/original/`
[x] Pushear el proyecto en un nuevo repo (ahora esta en el repo de Tomi)

Domingo 31 de Agosto
--------------------
[x] Editar `preprocess_eda.py` para usar 15 segundos extra (20:15 min DMT, 10:15 min Reposo) para plots mÃ¡s limpios.
[x] Crear archivo `config.py` con todos los paths y datos de config del proyecto.
[x] Adaptar preprocess_eda.py para extraer todas las metricas de 
interes de EDA
[x] Hacer testeo exploratorio de la version actual de `preprocess_eda.py` en un nuevo script a guardarse en `./test`.
Este script debe testear las seÃ±ales de EDA extraidas para el sujeto de prueba (S04). Para eso, es necesario primero  filtrar el dataframe guardado en el .csv para quitar la columna Â´timeÂ´. Luego de eso, con `eda_plot()` puedo plotear los 4 archivos resultantes.

Comentario -> Parece que la extracciÃ³n de la actividad de SMNA no esta resuelta en NueroKit2, y de hecho parece que cvxEDA podria tener mejoras (e.g con transformers o a partir de sumar un prior sparse. Pero indagar esto va mas alla de los objetivos de este trabajo, y voy a continuar con los datos extraidos como variables de NeuroKit2).

[x] Generalizar `preprocess_eda.py` para que sea `preprocess_phys.py`y
y obtener asi todos los features tambien de resp y ecg (ademas de eda).
[x] Crear `test_phys_preprocessing.py` para testear que los plots esten bien para las 3 medidas (con la generalizacion de `preprocess_eda.py` a `preprocess_phys.py`).
[x] Correr `python scripts/preprocess_phys.py` que me deberia preprocesar todos los particiapantes (TODOS y no solo los validos).

Lunes 15 de Septiembre
[x] Modificar `test_phys_preprocessing.py`para que al correrlo (por ahora solo para el S01) me permita anotar manualmente en consola / terminal las anotaciones que luego se reflejaran en el json (ver los cambios que hice en el chat de cursor a la derecha, para entener el proceso).


[x] En `preprocess_phys.py`, implementar el metodo `kbk_scr()` de biosppy como metodo extra / complementario sobre la seÃ±al de EDA. Esto nos dara 3 arrays (i.e. SCR onsets, SCR peaks and SCR amplitudes) que deben combinarse en un unico DataFrame y guardarse como un archivo extra al archivo de eda, agregandole el sufijo (`_kbk_scr`). Por ejemplo, si el archivo resultante de EDA de correr `preprocess_phys.py` es `S02_dmt_session2_high.csv`, este nuevo archivo complementario sera  `S02_dmt_session2_high_kbk_scr.csv`

[x]  En `preprocess_phys.py`, implementar exactamente lo mismo que hice en el paso anterior con `kbk_scr()` pero con la funcion `emotiphai_eda()` (que tambien devuelve 3 arrays de onsets, peaks y amplitudes). Del mismo modo, el archivo resultante podria llamarse (a modo de ejemplo) `S02_dmt_session2_high_kbk_scr_emotiphai_eda.csv`


[x] Finalmente,  en `preprocess_phys.py` guardar un cuarto archivo complementario de EDA. Esta vez, se imlementara el metodo `biosppy.signals.eda.cvx_decomposition()` como metodo extra / complementario sobre la seÃ±al de EDA. Esto nos dara 3 arrays (i.e. edr, smna, edl) que debe guardarse como un archivo extra al archivo de eda, agregandole el sufijo (`_cvx_decomposition`). El resto de las cuatro variables que devuelve cvx_decomposition (i.e. tonic_coeff, linear_drift, res, obj) no quiero qeu se guarden. En este proceso por ejemplo, si el archivo resultante de EDA de correr `preprocess_phys.py` es `S02_dmt_session2_high.csv`, este nuevo archivo complementario sera  `S02_dmt_session2_high_cvx_decomposition.csv`

[x] Agregar en `preprocess_phys.py` algun paso de validacion para corroborar que los lenghts de los archivos de kbk_scr, emotiphai_eda y cvx_decomposition tenga la misma dimensioanlidad (imprimir los lenghts de ambos archivos e incluir un assert de eso)

Por ahora tengo implementado en `preprocess_phys.py` para obtener los features de las 3 seÃ±ales y ademas el emotiphai_eda y cvx_decomposition (kbk_scr lo borre por una cuestion de incompatibilidades de dependencias con numpu).
Recien chequee que los plots de `test_phys_preprocessing.py` me dan algo decente, asi que ahora dejo corriendo `preprocess_phys.py` para todos los participantes. `test_phys_preprocessing.py` todavia puede mejorarse, sobre todo tal vez se puede combinar la infom de emotiphai_eda con la info de cvx eda (todo junto en un mismo plot).
Ademas, tengo la idae de quedarme con la envolvente de SMNA como proxy de arousal (aunque tal vez el SCR extraido con el cxvEDA es suficiente)

[x] Quiero que en `test_phys_preprocessing.py`, al plot de cvxEDA le sumes los eventos extraido de "Emotiphai SCR". En concreto, quiero que en el plot de cvxEDA incluyas el `Onset` y el `Peak` como un punto en la serie temporal de cvxEDA. A su vez, representa `Amplitud` como una barra vertical qeu desciende desde el `Peak`. Tene en cuenta que el plot de cvxEDA esta en segundos mientras que el de Emotiphai tiene los timestamps en timepoints (sampling rate de 250Hz).

[x] Fijare si corrio bien `preprocess_phys.py` para todos los participantes

----
24/9
----

[x] Creo que esta fallando la forma en que se itera para buscar archivo en @test_phys_preprocessing.py.

Por ejemplo, el orden en que se estan procesando los archivos actualmente es el siguiente:

s01 ses02 dmt low 12 min eda
s01 ses 02 rest low 6 min eda

s01 ses02 dmt low 12 min ecg
s01 ses 02 rest low 6 min ecg

s01 ses02 dmt low 12 min resp
s01 ses 02 rest low 6 min resp

(luego no se proceso ni el s02 ni el s03, sino que pasa directamente al s04)

s04 ses01 dmt high 12 min eda
s04 ses01 rest high 6 min eda
s04 ses02 dmt low 12 min eda
s04 ses02 rest low 6 min eda

s04 ses01 dmt high 12 min ecg
s04 ses01 rest high 6 min ecg
s04 ses02 dmt low 12 min ecg
s04 ses02 rest low 6 min ecg

s04 ses01 dmt high 12 min resp
s04 ses01 rest high 6 min resp
s04 ses02 dmt low 12 min resp
s04 ses02 rest low 6 min resp

s05 ses01 dmt high 12 min eda
s05 ses01 resthigh 6 min eda
s05 ses02 dmt low 12 min eda
s05 ses02 rest low 6 min eda

s05 ses01 dmt high 12 min ecg
s05 ses01 resthigh 6 min ecg
s05 ses02 dmt low 12 min ecg
s05 ses02 rest low 6 min ecg

s05 ses01 dmt high 12 min resp
s05 ses01 resthigh 6 min resp
s05 ses02 dmt low 12 min resp
s05 ses02 rest low 6 min resp

(luego no se proceso ni el s06, s07 ni el s08, sino que pasa directamente al s09).


Chequear porque sucede esto, porque por ejemplo si vamos a `dmt_high` encontramos archivos para s02, s03, s06, s07, s08. Y en `dmt_low` encontramos a los sujetos s06, s07 y s08.

Sera que al iterar busca una combinaciÃ³n exacta entre sesiÃ³n y condiciÃ³n que si no encuentra pasa a la siguiente iteraciÃ³n?

Revisar el archivo para dar respuesta a este problema en el procesamiento / iteraciÃ³n de archivos en @test_phys_preprocessing.py



SEGUIR DESDE ACA ->
[ ]  Correr `test_phys_preprocessing.py` para ver archivo a archivo de cada participante si genera o no datos validos. Ir anotando este en algun archivo de logeo que luego `process_eda.py` tome como input para entender cuales son los archivos validos y cuales no. Comparar este logeo de archivos validos con las anotaciones manuales de Tomi a ver si coinciden.

Aca voy a poner las anotaciones generales que vaya teniendo de cada sujeto, uniendo con la data que tenia de acuerdo a anotaciones de Tomi tambien:

    -  La estimacion de HR es muy ruidosa, y estimo que eso va a ser asi para todos los participantes.
    - La medicion de respiracion parece ruidosa (mas en algunos sujetos que en otros), pero capaz es salvable. Deberia juntarme con Ignacio Rebollo para anlizar si tiene sentido ver esta data.
    - Revisar por que tengo este error:    `âš ï¸  NeuroKit2 plotting failed: Length of values (112) does not match length of index (111)`. Esto me paso en el s13 eda dmt ses02 high. Intentar resolver a ver que esta sucediendo. Me paso en otros sujetos tambien.

# Sujetos seÃ±ales problematicas 

| Sujeto | Estado |
|--------|--------|
| S01    | INVALID | Faltan archivos de 1 sesion completa y no entiendo por que (buscarla y rechequear)
| S02    | INVALID |
| S03    | INVALID |
| S04    | vÃ¡lido |
| S05    | vÃ¡lido |
| S06    | vÃ¡lido |
| S07    | vÃ¡lido |
| S08    | DMT_2 (seÃ±al muerta), INVALID |
| S09    | vÃ¡lido |
| S10    | DMT_2 (seÃ±al muerta), INVALID |
| S11    | DMT_2 (seÃ±al muerta), INVALID |
| S12    | DMT_2 (seÃ±al muerta, DMT_1 estÃ¡ bien), INVALID |
| S13    | vÃ¡lido |
| S15    | DMT_2 (seÃ±al muerta), INVALID |
| S16    | vÃ¡lido |
| S17    | vÃ¡lido |
| S18    | vÃ¡lido |
| S19    | vÃ¡lido |
| S20    | vÃ¡lido |

Faltan archivos del sujeto 01, 02 y 03:
  Missing files:
   ðŸ“‚ EDA:
      âŒ S01 - EDA DMT High Dose
      âŒ S01 - EDA Resting High Dose
      âŒ S02 - EDA DMT Low Dose
      âŒ S02 - EDA Resting Low Dose
      âŒ S03 - EDA DMT Low Dose
      âŒ S03 - EDA Resting Low Dose
   ðŸ“‚ ECG:
      âŒ S01 - ECG DMT High Dose
      âŒ S01 - ECG Resting High Dose
      âŒ S02 - ECG DMT Low Dose
      âŒ S02 - ECG Resting Low Dose
      âŒ S03 - ECG DMT Low Dose
      âŒ S03 - ECG Resting Low Dose
   ðŸ“‚ RESP:
      âŒ S01 - RESP DMT High Dose
      âŒ S01 - RESP Resting High Dose
      âŒ S02 - RESP DMT Low Dose
      âŒ S02 - RESP Resting Low Dose
      âŒ S03 - RESP DMT Low Dose
      âŒ S03 - RESP Resting Low Dose

[ ] Cuando termine de hacer esto, revisar por que faltan tantos archivos. Fijarme si estan en la data original, o que.

[ ] Hacer ploteos por participante comparando el AUC de SMNA para el caso de dosis alta y dosis baja. Esto nos va a ayudar a explorar mejor los datos sujeto a sujeto (nos falta todavia ese insight)

[ ] Adaptar `process_eda.py` para replicar figuara de EDA y HR de Tomi, pero con nueva forma de obtencion de los datos segun fueron guardados al correr `preprocess_eda.py`. Ya fui adaptandolo, sacando metricas de SMNA, etc, pero no me convencio para nada el resultado. Diego me propuso qeu si esta muy ruidoso puedo fitear un pilonomio a eso, pero no se. Tambien algo tipo el area bajo la curva (AUC) deberia funcionar bien, probar AUC de SMNA y de EDR a ver que funciona mejor.

[ ] Hacer espectrograma pero con los datos de EDA y ECG (dos figuras distitnas), a nivel exploratorio.

[ ] Hacer el equivalente a un ANOVA no parametrico (2x2) con el AUC de SMNA, asi aprovechamos tambien la linea de base. Quedarme solamnete con los 10 minutos iniclales de cada registro.

[ ] Con esto, hablarle a Enzo para avanzar con el paper

[ ] Que pasa si comparamos el PSD de EEG en los momentos de SMNA > 0 comparados con SMNA = 0?. COmo cambia el PSD dependiendo la actividad autonomica?